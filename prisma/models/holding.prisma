
model Holding {
  holding_id                  String           @id @default(uuid())

  /// Plaid account_id associated with the holding
  account_id                  String

  /// Plaid security_id associated with the holding
  security_id                 String

  /// Last price reported by the institution for this security
  institution_price           Decimal          @db.Decimal(20, 8)

  /// Market effective date for institution_price
  institution_price_as_of     DateTime         @db.Timestamptz(3)

  /// Exact timestamp when institution_price was current (if provided by institution)
  institution_price_datetime  DateTime?        @db.Timestamptz(3)

  /// Total market value of the holding as reported by the institution
  institution_value           Decimal          @db.Decimal(20, 2)

  /// Total cost basis of the holding
  cost_basis                  Decimal          @db.Decimal(20, 2)

  /// Total quantity of the asset held
  quantity                    Decimal          @db.Decimal(20, 8)

  /// ISO-4217 currency code (exactly one of iso_currency_code or unofficial_currency_code must be set)
  iso_currency_code           String?

  /// Unofficial currency code (e.g. crypto, non-ISO currencies)
  unofficial_currency_code    String?

  /// Quantity of vested assets held (equities only)
  vested_quantity             Decimal?         @db.Decimal(20, 8)

  /// Value of vested holdings
  vested_value                Decimal          @db.Decimal(20, 2)

  /// Expected annualized return assumption for projections (e.g. 0.0600 = 6%)
  expected_annual_return_rate Decimal          @default(0.06) @db.Decimal(5, 4)

  // history                     HoldingHistory

  user_id                     String
  member_id                   String
  household_id                String?

  account                     Account         @relation(fields: [account_id], references: [account_id], onDelete: Cascade)
  security                    Security        @relation(fields: [security_id], references: [security_id], onDelete: Cascade)
  user                        User            @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  member                      HouseholdMember @relation(fields: [member_id], references: [member_id], onDelete: Cascade)
  household                   Household?      @relation(fields: [household_id], references: [household_id], onDelete: Cascade)

  // ----- Timestamps -----
  created_at                  DateTime         @default(now()) @db.Timestamptz(3)
  updated_at                  DateTime         @updatedAt @db.Timestamptz(3)

  /// Prevent duplicate holdings per user/account/security
  @@unique([security_id, user_id, account_id])

  @@index([security_id, user_id, account_id])
  @@index([user_id])
  @@index([account_id])
  @@index([member_id])
}



// model HoldingHistory {
//   id                         Int        @id @default(autoincrement())

//   /// Snapshot of cost basis at this point in time
//   cost_basis                 Decimal    @db.Decimal(20, 2)

//   institution_price          Decimal    @db.Decimal(20, 8)
//   institution_price_as_of    DateTime   @db.Timestamptz(3)
//   institution_price_datetime DateTime?  @db.Timestamptz(3)
//   institution_value          Decimal    @db.Decimal(20, 2)

//   /// Currency at the time of the snapshot
//   iso_currency_code          String?
//   unofficial_currency_code   String?

//   vested_quantity            Decimal?   @db.Decimal(20, 8)
//   vested_value               Decimal    @db.Decimal(20, 2)
//   quantity                   Decimal    @db.Decimal(20, 8)

//   /// Denormalized identifiers preserved for point-in-time historical accuracy
//   account_id                 String
//   security_id                String
//   user_id                    String
//   member_id                  String
//   household_id               String?

//   holding_id                 String?
//   holding                    Holding?   @relation(fields: [holding_id], references: [holding_id])

//   // ----- Timestamps -----
//   created_at                 DateTime   @default(now()) @db.Timestamptz(3)
//   updated_at                 DateTime   @updatedAt @db.Timestamptz(3)

//   /// One snapshot per holding per market date
//   @@unique([holding_id,      institution_price_as_of])

//   @@index([holding_id])
//   @@index([holding_id, created_at(sort: Desc)])
// }
